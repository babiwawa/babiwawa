import{bX as v,b$ as I,bG as O,ay as x,aq as S,bu as n,aW as z,c9 as k,bz as D,bx as p,bw as H,ca as $,c0 as N,bN as j,bA as q,cb as A}from"./history-5e0c3cab.js";const R=async(a,{input:e="input",keyword:_=i=>!1,paste:y=i=>!0}={})=>{const i=v(),u=I(i.items.tool,i.items.feature),b=$(),g=O(),o=t=>{var w;const f=(w=b.query)==null?void 0:w[t];return n.isString(f)?f:""},r=(()=>{const t=o("keyword");return t===""?!1:_(t)})(),s=t=>(e&&n.isNumber(a[e])&&t[e]&&(t[e]=n.toNumber(t[e])),{items:n.cloneDeep(t),field:e}),m=()=>{if(u.length()<1)return null;if(o("history"))return u.get(parseInt(o("history")));if(r){const t=u.all();for(let f in t)if(A(r,t[f].v))return u.get(parseInt(f));return null}return u.get(0)};e&&!(e in a)&&(e="",y=!1);const h=e&&N(a[e]);a=r?n.merge(a,r):a;let c=n.cloneDeep(a);if(e){let t=j.get("_temp_input_storage")||o("input");if(t!=="")return h?(c[e].value=t,s(c)):s({...c,[e]:t})}const l=m();if(l)return s(n.mergeWith(c,l,(t,f)=>{if(k(t))return t.unserialize(f)}));if(e&&y!==!1&&g.items.auto_read_copy){const t=await q();if(t.trim()&&y(t))return h?(c[e].value=g.items.auto_read_copy_filter?t.trim():t,s(c)):s({...c,[e]:g.items.auto_read_copy_filter?t.trim():t})}return s(c)},U=a=>{const e=v(),_=I(e.items.tool,e.items.feature),y=O(),i=x(a.items);S(()=>{_.save()});const u=n.debounce(function(){const o=r=>{if(!n.isObject(r))return r;if(k(r)){if(!r.isSaveHistory())throw new Error("Do not save");return r.serialize()}for(let s in r)r[s]=o(r[s]);return r};try{_.push(o(n.cloneDeep(z(i))))}catch{}},500),b=()=>{u()};return{current:i,save:b,success:({message:o=$t("main_ui_success"),message_type:r="success",copy_text:s="",copy_image:m="",is_save:h=!0}={})=>{if(h&&b(),s!==""&&y.items.auto_save_copy)return D(s,()=>{p.success($t("main_ui_copy_text_ok"))});if(m!==""&&y.items.auto_save_copy)return H(m,()=>{p.success($t("main_ui_copy_image_ok"))});o!==""&&p[r](o,{offset:150,showClose:!0})}}};export{R as i,U as u};
