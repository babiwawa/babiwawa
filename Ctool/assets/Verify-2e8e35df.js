import{u as $,i as T}from"./action-dcd662bd.js";import{c as f,a as D,T as a}from"./index-4f369466.js";import{s as w}from"./index-636623a5.js";import{A,bi as E,k as I,m as C,bj as i,aF as l,aG as H,as as g,x as u,bl as S,o as U,a$ as o}from"./history-5e0c3cab.js";import"./_commonjsHelpers-87174ba5.js";import"./index-69be48ff.js";const J=A({__name:"Verify",async setup(z){let s,c;const e=$(([s,c]=E(()=>T({sourceData:f("text"),signValue:f("hex"),option:{public_key:"",user_id:"1234567812345678"},output:D("text")})),s=await s,c(),s)),V=I(()=>{if(e.current.sourceData.text.isEmpty()||e.current.signValue.text.isEmpty()||e.current.option.public_key==="")return a.empty();if(e.current.sourceData.text.isError())return e.current.sourceData.text;if(e.current.signValue.text.isError())return e.current.signValue.text;try{let t=e.current.option.public_key;if(t.length==128)t="04"+t;else if(t.length!=130||!t.startsWith("04"))return a.fromError($error($t("public_key_error")));return w.sm2.doVerifySignature(e.current.sourceData.text.toArray(),e.current.signValue.text.toHexString(),t,{hash:!0,userId:e.current.option.user_id})?a.fromString($t("sign_verify_ok")):a.fromString($t("sign_verify_fail"))}catch(t){return a.fromError($error(t))}});return(t,r)=>{const m=l("TextInput"),d=l("Input"),p=l("Align"),h=l("HelpTip"),x=l("Card"),y=l("TextOutput"),b=l("HeightResize"),v=H("row");return g(),C(b,{ignore:"",append:[".ctool-page-option"],reduce:10},{default:i(({small:k,large:_})=>[u(p,{direction:"vertical"},{default:i(()=>[S((g(),U("div",null,[u(m,{modelValue:o(e).current.sourceData,"onUpdate:modelValue":r[0]||(r[0]=n=>o(e).current.sourceData=n),height:_,placeholder:t.$t("sm2_source_data"),upload:"file"},null,8,["modelValue","height","placeholder"]),u(m,{modelValue:o(e).current.signValue,"onUpdate:modelValue":r[1]||(r[1]=n=>o(e).current.signValue=n),height:_,placeholder:t.$t("sm2_sign_value"),allow:["hex","base64"]},null,8,["modelValue","height","placeholder"])])),[[v,"1-1"]]),u(x,{title:t.$t("main_ui_config"),class:"ctool-page-option"},{extra:i(()=>[u(p,null,{default:i(()=>[u(h,{link:"https://github.com/JuneAndGreen/sm-crypto"})]),_:1})]),default:i(()=>[u(p,{horizontal:"center"},{default:i(()=>[u(d,{modelValue:o(e).current.option.public_key,"onUpdate:modelValue":r[2]||(r[2]=n=>o(e).current.option.public_key=n),label:t.$t("sm2_public_key")},null,8,["modelValue","label"]),u(d,{modelValue:o(e).current.option.user_id,"onUpdate:modelValue":r[3]||(r[3]=n=>o(e).current.option.user_id=n),label:t.$t("sm2_userId")},null,8,["modelValue","label"])]),_:1})]),_:1},8,["title"]),u(y,{modelValue:o(e).current.output,"onUpdate:modelValue":r[4]||(r[4]=n=>o(e).current.output=n),allow:["hex"],content:V.value,height:k,onSuccess:r[5]||(r[5]=n=>o(e).save())},null,8,["modelValue","content","height"])]),_:2},1024)]),_:1},8,["append"])}}});export{J as default};
